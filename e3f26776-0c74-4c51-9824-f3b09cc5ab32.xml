<joblist>
  <job>
    <defaultTab>nodes</defaultTab>
    <description>Example of file modifications</description>
    <executionEnabled>true</executionEnabled>
    <group>Rules</group>
    <id>e3f26776-0c74-4c51-9824-f3b09cc5ab32</id>
    <loglevel>INFO</loglevel>
    <name>file_modification</name>
    <nodeFilterEditable>false</nodeFilterEditable>
    <plugins />
    <scheduleEnabled>true</scheduleEnabled>
    <schedules />
    <sequence keepgoing='false' strategy='ruleset'>
      <command>
        <description>Check Service</description>
        <exec>cat /home/rundeck/service.status | sed -E -n 's/.*\(Stopped\|Running\).*/\\1/p'</exec>
        <plugins>
          <LogFilter type='key-value-data'>
            <config>
              <invalidKeyPattern>\s|\$|\{|\}|\\</invalidKeyPattern>
              <logData>true</logData>
              <name>service_status</name>
              <regex>^(.*)</regex>
            </config>
          </LogFilter>
        </plugins>
      </command>
      <command>
        <step-plugin type='export-var'>
          <configuration>
            <entry key='export' value='service_status' />
            <entry key='group' value='export' />
            <entry key='value' value='${data.service_status*}' />
          </configuration>
        </step-plugin>
      </command>
      <command>
        <exec>echo ${export.service_status}</exec>
      </command>
      <command>
        <exec>sed -i 's/Stopped/Running/g' /home/rundeck/service.status</exec>
      </command>
      <command>
        <exec>sed -i 's/Running/Stopped/g' /home/rundeck/service.status</exec>
      </command>
      <pluginConfig>
        <WorkflowStrategy>
          <ruleset>
            <rules><![CDATA[# Autogenerated Directives
[1] run-at-start
[2] run-after:1
[3] run-after:2
[4] if:export.service_status==Stopped
[5] if:export.service_status==Running

# Autogenerated Conditions
]]></rules>
          </ruleset>
        </WorkflowStrategy>
      </pluginConfig>
    </sequence>
    <uuid>e3f26776-0c74-4c51-9824-f3b09cc5ab32</uuid>
  </job>
</joblist>
